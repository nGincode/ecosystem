(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[130],{6829:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/file",function(){return t(3632)}])},3632:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return u}});var l=t(5893),n=t(7294),o=t(6501),s=t(7066),i=t(9335),r=t(6455),d=t.n(r),c=t(5675),m=t.n(c);function u(e){var a,t,r;let{userData:c,setuserData:u}=e,[h,v]=(0,n.useState)([]),[p,g]=(0,n.useState)(),[f,x]=(0,n.useState)([]),[w,j]=(0,n.useState)(!0),[y,N]=(0,n.useState)([]),b="Files";"undefined"!=typeof document&&(document.title=b);let k=async function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if("create_user"===e)try{await (0,s.Z)({method:"POST",url:"/api/user",data:a,headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}}).then(e=>{g(e.data.data),o.ZP.success(e.data.massage),$(".btn-close").trigger("click"),document.getElementById("formCreate").reset(),k("view_user")})}catch(e){o.ZP.error(e.response.data.massage)}};(0,n.useEffect)(()=>{var e,a,t,l,n,i;(async function(e){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1],"view_permission"===e)try{await (0,s.Z)({method:"GET",url:"/api/permission",headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}}).then(e=>{x(e.data.data.map((e,a)=>({label:e.name,value:e.name})))})}catch(e){o.ZP.error(e.response.data.massage)}try{var a;await (0,s.Z)({method:"GET",url:"/api/file/"+(null===(a=JSON.parse(localStorage.getItem("companyActive")))||void 0===a?void 0:a.label),headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}}).then(e=>{if(y.length>1){let a=[];y.map((t,l)=>{if(0==l){var n,o;a.push(null===(o=e.data.data)||void 0===o?void 0:null===(n=o[0])||void 0===n?void 0:n.children)}else a.push(t)}),N(a)}else{var a,t;N([null===(t=e.data.data)||void 0===t?void 0:null===(a=t[0])||void 0===a?void 0:a.children])}})}catch(e){o.ZP.error(e.response.data.massage)}})("view_permission"),v(null!==(i=null==c?void 0:null===(n=c.permission)||void 0===n?void 0:null===(l=n.data)||void 0===l?void 0:null===(t=l.map(e=>e.data.find(e=>{if(e.label==b)return e})))||void 0===t?void 0:null===(a=t.filter(e=>void 0!==e))||void 0===a?void 0:null===(e=a[0])||void 0===e?void 0:e.checklist)&&void 0!==i?i:[])},[c,w]),console.log(y);let[S,B]=(0,n.useState)(0),[C,P]=(0,n.useState)([]),[_,I]=(0,n.useState)(),[Z,E]=(0,n.useState)(),[F,M]=(0,n.useState)(""),[z,A]=(0,n.useState)(!1),[L,O]=(0,n.useState)({x:0,y:0}),T=e=>{"folder"===e.type&&e.children&&(N(a=>[...a,e.children]),B(S+1),P(a=>[...a,e.name]))},D=e=>{I(e.id),E(e)},J=()=>{C.pop(),P([...C]),E(y[S>0?S-1:0]),N(y.filter((e,a)=>a!==S)),B(S>0?S-1:0)},X=async(e,a)=>{let t=null===(r=null!==(m=e.location)&&void 0!==m?m:null===(c=JSON.parse(localStorage.getItem("companyActive")))||void 0===c?void 0:c.label)||void 0===r?void 0:r.split("\\");t.splice(t.length-1,1);let l=t.join("\\");if("delete"==a)d().fire({icon:"info",title:"Delete !!!",text:"Are You sure want to delete ".concat(null!==(u=e.name)&&void 0!==u?u:""," ?"),showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#686868",confirmButtonText:"Delete"}).then(async a=>{if(a.isConfirmed)try{await (0,s.Z)({method:"POST",url:"/api/file",data:{type:"delete",location:e.location,locationBefore:l},headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}}).then(a=>{o.ZP.success(a.data.massage);let t=[];y.map((l,n)=>{n==y.length-1?t.push([...a.data.data.filter(a=>a.location!==e.location)]):t.push(l)}),E(t.find(e=>e.location===l)),N(t),j(!w)})}catch(e){o.ZP.error(e.response.data.massage)}});else if("rename"==a);else if("upload"==a){var n,i,r,c,m,u,h,v,p=new FormData;for(let a=0;a<e.file.length;a++)p.append("files",e.file[a]);p.append("type",a),p.append("location",null!==(v=e.location)&&void 0!==v?v:null===(h=JSON.parse(localStorage.getItem("companyActive")))||void 0===h?void 0:h.label),p.append("locationBefore",l);try{await (0,s.Z)({method:"POST",url:"/api/file",data:p,headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"multipart/form-data"}}).then(e=>{o.ZP.success(e.data.massage);let a=[];y.map((t,l)=>{l==y.length-1?a.push([...e.data.data]):a.push(t)}),N(a),document.getElementById("upload").value="",j(!w)})}catch(e){o.ZP.error(e.response.data.massage)}}else if("create_folder"==a)try{await (0,s.Z)({method:"POST",url:"/api/file",data:{type:a,location:null!==(i=e.location)&&void 0!==i?i:null===(n=JSON.parse(localStorage.getItem("companyActive")))||void 0===n?void 0:n.label,name:e.nameFolder,locationBefore:l},headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}}).then(e=>{o.ZP.success(e.data.massage);let a=[];y.map((t,l)=>{l==y.length-1?a.push([...e.data.data]):a.push(t)}),N(a),j(!w)})}catch(e){o.ZP.error(e.response.data.massage)}else window.location.href="/files/"+e.location},H=e=>{e.target.closest(".custom-menu")||(A(!1),document.removeEventListener("click",H))},R=(e,a)=>{D(a),e.preventDefault(),A(!0);let t=e.clientY-150,l=window.innerWidth;e.clientX,O({x:l>1024?e.clientX-360:e.clientX,y:t}),document.addEventListener("click",H)},V=0;return null===(a=y[S])||void 0===a||a.map(e=>V+=Number(e.meta.size.replaceAll(" KB",""))),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"col-12 mb-5",children:(0,l.jsx)("h1",{className:"hp-mb-0 text-4xl font-bold",id:"subject",children:b})}),(0,l.jsx)("div",{className:"row mb-32 gy-32",children:(0,l.jsx)("div",{className:"col-12",children:(0,l.jsx)("div",{className:"card hp-contact-card mb-32 -mt-3 shadow-md",children:(0,l.jsx)("div",{className:"card-body px-0",children:(0,l.jsxs)("div",{className:"file-manager-container",children:[(0,l.jsxs)("div",{className:"header",children:[(0,l.jsxs)("div",{className:"breadcumb",children:[(0,l.jsxs)("span",{onClick:()=>{P([]),B(0)},children:[null===(t=JSON.parse(localStorage.getItem("companyActive")))||void 0===t?void 0:t.label," (",function(e){if(0===e)return"0 KB";let a=Math.floor(Math.log(e)/Math.log(1024)),t=parseFloat((e/Math.pow(1024,a)).toFixed(2));return"".concat(t," ").concat(["KB","MB","GB","TB","PB","EB","ZB","YB"][a])}(V),")"]}),C.map((e,a)=>(0,l.jsxs)(n.Fragment,{children:[(0,l.jsx)("b",{children:"/"}),(0,l.jsx)("span",{onClick:()=>{let t=C.indexOf(e);t>-1&&C.splice(t+1),P([...C]),B(a+1)},children:e.toLowerCase()})]},e))]}),(0,l.jsxs)("div",{className:"search-container flex items-center gap-2 text-center",children:[1==y.length?(0,l.jsxs)(i.Popover,{placement:"bottom",animate:{mount:{scale:1,y:0},unmount:{scale:0,y:25}},children:[(0,l.jsx)(i.PopoverHandler,{children:(0,l.jsx)(i.Button,{className:"w-80 ",variant:"gradient",color:"cyan",children:" Create Folder"})}),(0,l.jsxs)(i.PopoverContent,{className:"w-96 p-3",children:[(0,l.jsx)(i.Typography,{variant:"small",color:"blue-gray",className:"mb-1 font-bold",children:"Name Folder"}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)(i.Input,{id:"nameFolder",size:"lg",variant:"standard",placeholder:"name",className:" !border-t-blue-gray-200 focus:!border-t-gray-900 border-b-1",labelProps:{className:"before:content-none after:content-none"}}),(0,l.jsx)(i.Button,{onClick:()=>{var e;X({...Z,nameFolder:null===(e=document.getElementById("nameFolder"))||void 0===e?void 0:e.value},"create_folder"),document.getElementById("nameFolder").value=""},className:"w-32 h-10 mt-2 ",variant:"gradient",color:"cyan",children:"Create"})]})]})]}):null,(0,l.jsx)("input",{onChange:e=>X({...Z,file:e.target.files},"upload"),type:"file",multiple:!0,className:"hidden",name:"upload",id:"upload"}),(0,l.jsx)(i.Button,{className:"w-80 cursor-pointer",variant:"gradient",color:"cyan",children:(0,l.jsx)("label",{htmlFor:"upload",className:" cursor-pointer",children:"Upload File"})}),(0,l.jsx)("input",{type:"text",placeholder:"Search files...",onChange:e=>{M(e.target.value)},value:F})]})]}),(0,l.jsxs)("div",{className:"body",children:[(0,l.jsxs)("div",{className:"file-container-headers",children:[(0,l.jsx)("div",{children:"File"}),(0,l.jsx)("div",{children:"Size"}),(0,l.jsx)("div",{children:"Modified"})]}),S>0&&(0,l.jsx)("div",{className:"files-list",style:{marginBottom:"0px",height:"35px"},onClick:()=>J(),children:(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 15 3 9m0 0 6-6M3 9h12a6 6 0 0 1 0 12h-3"})})}),z&&(0,l.jsx)(e=>{let{handleMenuItemClick:a,menuPosition:t}=e,n=(null==Z?void 0:Z.type)=="file"?["Delete","Download"]:["Delete"],o=e=>{a(e)};return(0,l.jsx)("div",{className:"custom-menu rounded shadow bg-white absolute  z-50",style:{left:t.x,top:t.y},children:n.map(e=>(0,l.jsxs)("div",{className:"cursor-pointer rounded px-4 py-2  hover:bg-gray-400 flex",onClick:()=>o(e),children:["Delete"==e?(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4 text-red-600 mr-2",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"})}):"Rename"==e?(0,l.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-4 h-4 text-green-600  mr-2",children:[(0,l.jsx)("path",{d:"M21.731 2.269a2.625 2.625 0 00-3.712 0l-1.157 1.157 3.712 3.712 1.157-1.157a2.625 2.625 0 000-3.712zM19.513 8.199l-3.712-3.712-8.4 8.4a5.25 5.25 0 00-1.32 2.214l-.8 2.685a.75.75 0 00.933.933l2.685-.8a5.25 5.25 0 002.214-1.32l8.4-8.4z"}),(0,l.jsx)("path",{d:"M5.25 5.25a3 3 0 00-3 3v10.5a3 3 0 003 3h10.5a3 3 0 003-3V13.5a.75.75 0 00-1.5 0v5.25a1.5 1.5 0 01-1.5 1.5H5.25a1.5 1.5 0 01-1.5-1.5V8.25a1.5 1.5 0 011.5-1.5h5.25a.75.75 0 000-1.5H5.25z"})]}):(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4 text-blue-600 mr-2",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"})})," ",e]},e))})},{handleMenuItemClick:(e,a)=>{switch(e){case"Delete":X(Z,"delete");break;case"Rename":X(Z,"rename");break;default:X(Z,"Download")}A(!1)},menuPosition:L}),null===(r=y[S])||void 0===r?void 0:r.filter(e=>e.name.toLowerCase().includes(F.toLowerCase())).map(e=>(0,l.jsxs)("div",{className:"files-list ".concat(e.id===_?"active":""),onClick:()=>D(e),onDoubleClick:()=>T(e),onContextMenu:a=>R(a,e),children:[(0,l.jsxs)("div",{className:"file-container",children:[(0,l.jsx)("div",{className:"".concat(e.type)}),(0,l.jsx)("div",{className:"filename",style:{pointerEvents:"none"},children:e.name})]}),(0,l.jsx)("div",{className:"size",children:e.meta.size}),(0,l.jsx)("div",{className:"date",children:e.meta.modified})]},e.id+e.name?e.id+e.name:"0000")),y.length&&(null==y?void 0:y[0].length)?null:(0,l.jsxs)("div",{className:"text-center w-full text-gray-500",children:[(0,l.jsxs)("div",{className:"flex justify-center mt-1 -mb-7 ",children:[(0,l.jsx)(m(),{src:"/img/noResult.gif",width:200,height:200,alt:"noResult"})," "]}),(0,l.jsx)("div",{className:"text-lg",children:"No results found"})]})]})]})})})})})]})}}},function(e){e.O(0,[888,774,179],function(){return e(e.s=6829)}),_N_E=e.O()}]);